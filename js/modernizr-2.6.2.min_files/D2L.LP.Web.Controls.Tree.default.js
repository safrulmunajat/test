
D2L.Control.Tree=D2L.Control.extend({Construct:function(){arguments.callee.$.Construct.call(this);this.m_activeNode=null;this.m_dragDropMode=D2L.DragDrop.Modes.None;this.m_dragDropInfo=null;this.m_siblingDragDropInfo=null;this.m_hasSiblingDragDrop=false;this.m_hideRoot=false;this.m_lineStyle=D2L.Control.Tree.LineStyle.Solid;this.m_parameters=new D2L.Util.Dictionary;this.m_root=null;this.m_rpc=null;this.m_rpcSource=null;this.OnNodeActivation=new D2L.EventHandler},Adjust:function(){if(this.m_root)this.m_root.Adjust()},
IntegrateControlMin:function(deserializer){arguments.callee.$.IntegrateControlMin.call(this,deserializer);this.m_hideRoot=deserializer.GetBoolean();this.m_parameters=deserializer.GetObject(D2L.Util.Dictionary);this.m_rpc=deserializer.GetMember();this.m_rpcSource=deserializer.GetMember();this.m_lineStyle=deserializer.GetMember();hasRoot=deserializer.GetBoolean();if(hasRoot){rootJsClass=deserializer.GetMember();this.m_root=deserializer.GetObject(rootJsClass)}hasDragDropInfo=deserializer.GetBoolean();
if(hasDragDropInfo){var dragDropSettingsControlId=deserializer.GetObjectMin(D2L.Control.Id);this.m_dragDropInfo=UI.GetControl(dragDropSettingsControlId.ID(),dragDropSettingsControlId.SID()).GetDragDropInfo()}this.m_dragDropMode=deserializer.GetMember();this.m_hasSiblingDragDrop=deserializer.GetBoolean();if(this.m_hasSiblingDragDrop){var dragDropSettingsControlId=deserializer.GetObjectMin(D2L.Control.Id);this.m_siblingDragDropInfo=UI.GetControl(dragDropSettingsControlId.ID(),dragDropSettingsControlId.SID()).GetDragDropInfo()}this.BuildChildrenDom();
if(this.m_root)this.m_root.IntegrateChild(null,this);if(this.IsRootHidden()&&this.m_root.GetDomNode())this.m_root.m_wrapper1.style.display="none";this.Adjust();this.AppendChild(this.m_root)},BuildDom:function(){arguments.callee.$.BuildDom.call(this);this.SetDomNode(this.CreateElement("div"));this.GetDomNode().className="dt_w";if(this.m_root&&!this.m_root.IsRendered())this.m_root.BuildDom();if(this.IsRootHidden()&&this.m_root.GetDomNode())this.m_root.m_wrapper1.style.display="none"},BuildChildrenDom:function(){this.IChildrenDomNode=
this.CreateElement("ul");var className="dt_m";if(this.GetTreeLineStyle()==D2L.Control.Tree.LineStyle.Solid)className+="s";else if(this.GetTreeLineStyle()==D2L.Control.Tree.LineStyle.Dotted)className+="d";else if(this.GetTreeLineStyle()==D2L.Control.Tree.LineStyle.None)className+="n";this.IChildrenDomNode.className=className;this.GetDomNode().appendChild(this.IChildrenDomNode)},GetActiveNode:function(){return this.m_activeNode},GetAllNodes:function(){var allNodes=[];var GetAllNodesRec=function(node){allNodes.push(node);
if(node.GetChildNodes().length>0)for(var i=0;i<node.GetChildNodes().length;i++)GetAllNodesRec(node.GetChildNodes()[i]);else return};GetAllNodesRec(this.GetRoot());return allNodes},GetDragDropMode:function(){return this.m_dragDropMode},GetDragDropInfo:function(){return this.m_dragDropInfo},GetSiblingDragDropInfo:function(){return this.m_siblingDragDropInfo},GetNodeByKey:function(key){var allNodes=this.GetAllNodes();for(var i=0;i<allNodes.length;i++){var node=allNodes[i];if(node.GetKey().toLowerCase()==
key.toLowerCase())return node}return null},GetParameter:function(name){return this.m_parameters.Get(name)},GetParameters:function(){return this.m_parameters},GetSelectedNodes:function(){var nodes=this.GetAllNodes();var result=[];for(var i=0;i<nodes.length;i++){var node=nodes[i];if(node.GetIsSelected())result.push(node)}return result},GetTreeLineStyle:function(){return this.m_lineStyle},GetRoot:function(){return this.m_root},GetRpc:function(){return this.m_rpc},GetRpcSource:function(){return this.m_rpcSource},
GetHasSiblingDragDrop:function(){return this.m_hasSiblingDragDrop},IsRootHidden:function(){return this.m_hideRoot},RemoveParameter:function(name){this.m_parameters.Remove(name)},SetActiveNode:function(node,fireEvent){if(fireEvent===undefined)fireEvent=true;if(this.GetActiveNode()!=node){var allNodes=this.GetAllNodes();for(var i=0;i<allNodes.length;i++)if(allNodes[i]!=node)allNodes[i].OnBeforeDeactivate.Trigger();node.OnBeforeActivate.Trigger();this.m_activeNode=node;if(fireEvent)this.OnNodeActivation.Trigger(this.m_activeNode)}},
SetParameter:function(name,value){this.m_parameters.Add(name,value)},SetRoot:function(root){if(!root.IsRendered())root.BuildDom();this.m_root=root}});D2L.Control.Tree.LineStyle={Solid:0,Dotted:1,None:2};
D2L.Control.Tree.TreeNode=D2L.Control.extend({Construct:function(){arguments.callee.$.Construct.call(this);this.m_childNodes=[];this.m_data=new D2L.Util.Dictionary;this.m_ddObject=null;this.m_ddHandle=null;this.m_doNotAdjust=false;this.m_canBeCollapsed=true;this.m_checkboxControl=null;this.m_customExpandCollapseIconPlaceholder=null;this.m_customSelectionCheckboxPlaceholder=null;this.m_collpaseImgTermDisabled=new D2L.Language.ImageTerm("Framework.TreeView2.actCollapseDisabled");this.m_collapseImgTerm=
new D2L.Language.ImageTerm("Framework.TreeView2.actCollapse");this.m_collapseAltText=new D2L.LP.Text.LangTerm("Framework.Tree.altCollapseNode");this.m_expandAltText=new D2L.LP.Text.LangTerm("Framework.Tree.altExpandNode");this.m_expandImgTerm=new D2L.Language.ImageTerm("Framework.TreeView2.actExpand");this.m_expandImgTermDisabled=new D2L.Language.ImageTerm("Framework.TreeView2.actExpandDisabled");this.m_expandCollapseIcon=null;this.m_expandCollapseAnimationSpeed=0.2;this.m_hasAutoExpandOnDragOver=
true;this.m_isActive=false;this.m_hasSelection=false;this.m_isSelected=false;this.m_isSelectionEnabled=true;this.m_fetchInProgress=false;this.m_isExpanded=true;this.m_key=null;this.m_nodeSpacing=4;this.m_loadChildNodesOnDemand=false;this.m_loadingImgTerm=new D2L.Language.ImageTerm("Framework.TreeView2.actLoading");this.m_levelSpacing="17px";this.m_leftSpacing=3;this.m_nodeTsectionSize=16;this.m_overrideDraggability=false;this.m_overrideDroppability=false;this.m_parentNode=null;this.m_renderedNodeWrapper=
null;this.m_selectedATHelp=null;this.m_siblingTopDragDropTarget=null;this.m_siblingBottomDragDropTarget=null;this.m_siblingDragDropTargetSize=6;this.m_subject="";this.m_tree=null;this.m_wrapper1=null;this.m_wrapper2=null;if(!this.m_canBeCollapsed)this.m_isExpanded=true;this.OnBeforeActivate=new D2L.EventHandler;this.OnBeforeDeactivate=new D2L.EventHandler;this.OnExpand=new D2L.EventHandler;this.OnCollapse=new D2L.EventHandler;this.OnSubjectChange=new D2L.EventHandler;this.OnAddNode=new D2L.EventHandler;
this.OnSelectionChange=new D2L.EventHandler;this.OnSelectionEnableDisableChange=new D2L.EventHandler},AddNode:function(node){this.AddNodeBefore(node,null)},AddNodeAfter:function(node,afterNode){var afterNodeIndex=0;for(var i=0;i<this.GetChildNodes().length;i++)if(this.GetChildNodes()[i]==afterNode){afterNodeIndex=i;break}if(afterNodeIndex>=0&&this.GetChildNodes().length>=afterNodeIndex+2)this.AddNodeBefore(node,this.GetChildNodes()[afterNodeIndex+1]);else this.AddNode(node)},AddNodeBefore:function(node,
beforeNode){this.m_ignoreTransformEvent=true;if(this.IsAncestor(node)||node==this)return;if(node==beforeNode)return;node.Remove();if(node.GetKey()!=null&&node.GetKey()!=""&&this.GetTree().GetNodeByKey(node.GetKey())!=null)return;if(this.m_loadChildNodesOnDemand)return;if(beforeNode==null)this.m_childNodes.push(node);else{var beforePos=-1;for(var i=0;i<this.m_childNodes.length;i++)if(this.m_childNodes[i]==beforeNode){beforePos=i;break}this.m_childNodes.splice(beforePos,0,node)}node.IntegrateChild(this,
this.GetTree());this.InsertBefore(node,beforeNode);if(this.GetTree()&&!this.m_doNotAdjust)this.GetTree().Adjust();this.OnAddNode.Trigger(node);this.m_ignoreTransformEvent=false},AddNodes:function(nodes){this.m_doNotAdjust=true;for(var i=0;i<nodes.length;i++)this.AddNode(nodes[i]);this.m_doNotAdjust=false;this.GetTree().Adjust()},AddNodesBefore:function(nodes,beforeNode){this.m_doNotAdjust=true;for(var i=0;i<nodes.length;i++)this.AddNodeBefore(nodes[i],beforeNode);this.m_doNotAdjust=false;this.GetTree().Adjust()},
AddNodesAfter:function(nodes,afterNode){this.m_doNotAdjust=true;for(var i=nodes.length-1;i>=0;i--)this.AddNodeAfter(nodes[i],afterNode);this.m_doNotAdjust=false;this.GetTree().Adjust()},Adjust:function(){if(this.GetChildNodes().length==0&&!this.m_loadChildNodesOnDemand)this.m_expandCollapseIcon.style.display="none";else this.m_expandCollapseIcon.style.display="inline";this.GetDomNode().className="dt_n_li";this.m_wrapper1.className="dt_n_cw1";if(this.GetParentNode()==null){this.GetDomNode().className=
"dt_n_lir";this.m_wrapper1.className="dt_n_cw1r"}if(this.GetParentNode()&&this.GetParentNode().GetFirstChild()==this)this.GetDomNode().className="dt_n_lif";if(this.GetParentNode()&&this.GetParentNode().GetLastChild()==this){this.GetDomNode().className="dt_n_lil";this.m_wrapper1.className="dt_n_cw1l"}if(this.GetTree().IsRootHidden()&&this.GetParentNode()==this.GetTree().GetRoot()){this.GetDomNode().style.backgroundImage="none";this.m_wrapper1.style.backgroundImage="none"}var ntss=Math.floor(this.m_nodeTsectionSize/
2);var spacing=this.m_nodeSpacing;if(this.GetTree().GetHasSiblingDragDrop())spacing+=this.m_siblingDragDropTargetSize;if(this.GetParentNode()&&this.GetParentNode().GetLastChild()==this)this.m_wrapper1.style.backgroundPosition=ntss-1+"px "+(100-spacing-ntss-1)*-1+"px";else this.m_wrapper1.style.backgroundPosition=ntss-1+"px "+(spacing+ntss+1)+"px";for(var i=0;i<this.GetChildNodes().length;i++)this.GetChildNodes()[i].Adjust()},BuildDom:function(){arguments.callee.$.BuildDom.call(this);this.SetDomNode(this.CreateElement("li"));
this.GetDomNode().className="dt_n_li";this.IChildrenDomNode=this.CreateElement("ul");this.IChildrenDomNode.className="dt_n_ul";this.m_wrapper1=this.CreateElement("div");this.m_wrapper1.className="dt_n_cw1";this.m_wrapper2=this.CreateElement("div");this.m_wrapper2.className="dt_n_cw2";this.m_selectedATHelp=this.CreateElement("div");this.m_selectedATHelp.className="dsr";this.m_selectedATHelp.appendChild(this.CreateTextNode(new D2L.LP.Text.LangTerm("Framework.Tree.lblSelected")));if(this.GetTree().GetHasSiblingDragDrop()){this.m_nodeSpacing=
0;this.m_siblingTopDragDropTarget=this.CreateElement("div");this.m_siblingTopDragDropTarget.className="dt_n_sddt";this.m_siblingTopDragDropTarget.style.paddingTop=this.m_siblingDragDropTargetSize/4+"px";this.m_siblingTopDragDropTarget.style.paddingBottom=this.m_siblingDragDropTargetSize/4+"px";this.m_siblingTopDragDropTarget.style.margin="1px";this.m_siblingTopDragDropTarget.style.marginBottom="2px";this.m_siblingBottomDragDropTarget=this.CreateElement("div");this.m_siblingBottomDragDropTarget.className=
"dt_n_sddt";this.m_siblingBottomDragDropTarget.style.paddingTop=this.m_siblingDragDropTargetSize/4+"px";this.m_siblingBottomDragDropTarget.style.paddingBottom=this.m_siblingDragDropTargetSize/4+"px";this.m_siblingBottomDragDropTarget.style.margin="1px";this.m_siblingBottomDragDropTarget.style.marginTop="2px";var line1=this.CreateElement("div");line1.style.height="2px";line1.style.visibility="hidden";line1.style.backgroundColor="#000000";var line2=line1.cloneNode(true);line1.style.fontSize="0px";line2.style.fontSize=
"0px";this.m_siblingTopDragDropTarget.appendChild(line1);this.m_siblingBottomDragDropTarget.appendChild(line2);this.m_wrapper2.appendChild(this.m_siblingTopDragDropTarget)}if(this.m_subject){this.m_expandAltText.SetSubject(this.m_subject);this.m_collapseAltText.SetSubject(this.m_subject)}this.BuildTSection();this.m_renderedNodeWrapper=this.CreateElement("div");if(this.GetHasSelection()){this.RenderSelection();if(this.m_customSelectionCheckboxPlaceholder==null)this.m_checkboxControl.AppendTo(this.m_renderedNodeWrapper);
else this.m_checkboxControl.AppendTo(this.m_customSelectionCheckboxPlaceholder)}this.m_wrapper2.appendChild(this.m_renderedNodeWrapper);var renderedNode=this.Render();if(D2L.Util.IsD2LControl(renderedNode))renderedNode.AppendTo(this.m_renderedNodeWrapper);else this.m_renderedNodeWrapper.appendChild(renderedNode);this.m_wrapper1.appendChild(this.m_wrapper2);if(this.GetTree().GetHasSiblingDragDrop())this.m_wrapper2.appendChild(this.m_siblingBottomDragDropTarget);var clearingDiv=this.CreateElement("div");
clearingDiv.className="clear";this.m_wrapper1.appendChild(clearingDiv);this.m_wrapper1.style.paddingTop=this.m_nodeSpacing+"px";var paddingPos=UI.GetCulture().GetMarginPaddingPosition(D2L.Culture.MarginPaddingPosition.First);if(this.GetTree().IsRootHidden()&&this==this.GetTree().GetRoot())this.IChildrenDomNode.style["padding"+paddingPos]="0px";else this.IChildrenDomNode.style["padding"+paddingPos]=this.m_levelSpacing;this.GetDomNode().style.backgroundPosition=Math.floor(this.m_nodeTsectionSize/2)-
1+"px 0px";this.GetDomNode().appendChild(this.m_wrapper1);this.GetDomNode().appendChild(this.IChildrenDomNode);this.InstallEvents()},BuildTSection:function(){var me=this;var defaultExpandCollapsePlaceholder=this.CreateElement("div");defaultExpandCollapsePlaceholder.style.height=this.m_nodeTsectionSize+"px";defaultExpandCollapsePlaceholder.style.width=this.m_nodeTsectionSize+this.m_leftSpacing+"px";var marginPos=UI.GetCulture().GetMarginPaddingPosition(D2L.Culture.MarginPaddingPosition.First);this.m_wrapper2.style["margin"+
marginPos]=this.m_nodeTsectionSize+this.m_leftSpacing+"px";this.m_expandCollapseIcon=this.CreateElement("a");var expandCollapseImage=this.CreateElement("img");if(this.GetChildNodes().length==0&&!this.m_loadChildNodesOnDemand)this.m_expandCollapseIcon.style.display="none";if(this.m_isExpanded){this.m_collapseImgTerm.Assign(expandCollapseImage,false);this.m_collapseAltText.GetText().Register(function(t){me.m_expandCollapseIcon.title=t;expandCollapseImage.alt=t;expandCollapseImage.title=t});this.IChildrenDomNode.style.display=
"block"}else{this.m_expandImgTerm.Assign(expandCollapseImage,false);this.m_expandAltText.GetText().Register(function(t){me.m_expandCollapseIcon.title=t;expandCollapseImage.alt=t;expandCollapseImage.title=t});this.IChildrenDomNode.style.display="none"}var me=this;this.m_expandCollapseIcon.href="javascript://";this.AttachObject(this.m_expandCollapseIcon,"onclick",function(evt){D2L.Util.Dom.CancelBubble(evt);me.SetIsExpanded(!me.m_isExpanded);return false});if(this.m_customExpandCollapseIconPlaceholder==
null)defaultExpandCollapsePlaceholder.appendChild(this.m_expandCollapseIcon);else if(D2L.Util.IsD2LControl(this.m_customExpandCollapseIconPlaceholder))this.m_customExpandCollapseIconPlaceholder.AppendChild(this.m_expandCollapseIcon);else this.m_customExpandCollapseIconPlaceholder.appendChild(this.m_expandCollapseIcon);D2L.Util.Style.ApplyFloat(defaultExpandCollapsePlaceholder,D2L.Style.Float.Left);this.m_expandCollapseIcon.appendChild(expandCollapseImage);this.m_wrapper1.appendChild(defaultExpandCollapsePlaceholder)},
Deserialize:function(deserializer){this.m_isExpanded=deserializer.GetMember("IsExpanded");this.m_isActive=deserializer.GetMember("IsActiveNode");this.m_key=deserializer.GetMember("Key");this.m_data=deserializer.GetObject("Data",D2L.Util.Dictionary);var hasChildren=deserializer.GetMember("HasChildren");if(hasChildren)this.m_childNodes=deserializer.GetObjectArray("ChildNodes");this.SetLoadChildNodesOnDemand(deserializer.GetMember("OnDemand"));this.m_subject=deserializer.GetMember("Subject");if(deserializer.HasMember("OverrideDraggability"))this.m_overrideDraggability=
deserializer.GetMember("OverrideDraggability");if(deserializer.HasMember("OverrideDroppability"))this.m_overrideDroppability=deserializer.GetMember("OverrideDroppability");this.m_hasSelection=deserializer.GetMember("HasSelection",false);this.m_isSelected=deserializer.GetMember("IsSelected",false);this.m_isSelectionEnabled=deserializer.GetMember("IsSelectionEnabled",true)},FetchChildNodes:function(parentNode){var dl=new D2L.Util.DelayedReturn;var FetchCallback=function(rpcResponse){if(rpcResponse.GetResponseType()==
D2L.Rpc.ResponseType.Success){var treeNode=rpcResponse.GetResult(D2L.Control.Tree.TreeNode);var childNodes=treeNode.GetChildNodes();dl.Trigger(childNodes)}};D2L.Rpc.Create("FetchNodes",FetchCallback,"/d2l/common/rpc/tree/tree.d2l").Call(this,this.GetTree().GetParameters(),this.GetTree().GetRpc(),this.GetTree().GetRpcSource());return dl},GetChildNodes:function(){return this.m_childNodes},GetData:function(key){return this.m_data.Get(key)},GetDragDropObject:function(){return this.m_ddObject},GetFirstChild:function(){if(this.GetChildNodes().length>
0)return this.GetChildNodes()[0];else return null},GetHasSelection:function(){return this.m_hasSelection},GetIsSelectionEnabled:function(){return this.m_isSelectionEnabled},GetIsSelected:function(){return this.m_isSelected},GetIsActive:function(){return this.m_isActive},GetKey:function(){return this.m_key},GetLastChild:function(){if(this.GetChildNodes().length>0)return this.GetChildNodes()[this.GetChildNodes().length-1];else return null},GetNextSibling:function(){if(this.GetParentNode())for(var i=
0;i<this.GetParentNode().GetChildNodes().length;i++)if(this.GetParentNode().GetChildNodes()[i]==this)if(this.GetParentNode().GetChildNodes().length>=i+2)return this.GetParentNode().GetChildNodes()[i+1];return null},GetParentNode:function(){return this.m_parentNode},GetPreviousSibling:function(){if(this.GetParentNode())for(var i=0;i<this.GetParentNode().GetChildNodes().length;i++)if(this.GetParentNode().GetChildNodes()[i]==this)if(i>0)return this.GetParentNode().GetChildNodes()[i-1];return null},GetSubject:function(){return this.m_subject},
GetTree:function(){return this.m_tree},IntegrateChild:function(parentNode,tree){this.SetTree(tree);this.SetParentNode(parentNode);if(!this.IsRendered())this.BuildDom();arguments.callee.$.IntegrateChild.call(this,parentNode,this.GetDomNode());for(var i=0;i<this.GetChildNodes().length;i++){this.GetChildNodes()[i].IntegrateChild(this,tree);this.AppendChild(this.GetChildNodes()[i])}if(this.GetIsActive())this.GetTree().SetActiveNode(this,false)},InstallDragDrop:function(){if(this.GetTree().GetDragDropMode()!=
D2L.DragDrop.Modes.None){var ddObject;var calculatedMode=this.GetTree().GetDragDropMode();if(this.GetTree().GetDragDropMode()==D2L.DragDrop.Modes.DraggableDroppable){if(this.IsDraggabilityOverridden())calculatedMode=D2L.DragDrop.Modes.Droppable;if(this.IsDroppabilityOverridden())calculatedMode=D2L.DragDrop.Modes.Draggable;if(this.IsDroppabilityOverridden()&&this.IsDraggabilityOverridden())calculatedMode=D2L.DragDrop.Modes.None}if(this.GetTree().GetDragDropMode()==D2L.DragDrop.Modes.Draggable)if(this.IsDraggabilityOverridden())calculatedMode=
D2L.DragDrop.Modes.None;if(this.GetTree().GetDragDropMode()==D2L.DragDrop.Modes.Droppable)if(this.IsDroppabilityOverridden())calculatedMode=D2L.DragDrop.Modes.None;if(calculatedMode==D2L.DragDrop.Modes.None)return;var handle=this.m_renderedNodeWrapper;if(this.m_ddHandle)if(D2L.Util.IsD2LControl(this.m_ddHandle)){if(!this.m_ddHandle.IsRendered())this.m_ddHandle.BuildDom();handle=this.m_ddHandle.GetDomNode()}else handle=this.m_ddHandle;if(calculatedMode==D2L.DragDrop.Modes.DraggableDroppable)ddObject=
new D2L.DragDrop.DraggableDroppable(this,handle);if(calculatedMode==D2L.DragDrop.Modes.Draggable)ddObject=new D2L.DragDrop.Draggable(this,handle);if(calculatedMode==D2L.DragDrop.Modes.Droppable)ddObject=new D2L.DragDrop.Droppable(this,handle);this.SetDragDropObject(ddObject);if(this.GetDragDropObject()&&this.GetTree().GetDragDropInfo())D2L.DragDrop.SetDragDropInfo(this.GetDragDropObject(),this.GetTree().GetDragDropInfo());var me=this;var timedExpansion=null;if((calculatedMode==D2L.DragDrop.Modes.Droppable||
calculatedMode==D2L.DragDrop.Modes.DraggableDroppable)&&this.m_hasAutoExpandOnDragOver){me.OnExpand.RegisterMethod(function(){D2L.DragDrop.GetManager().RefreshCache()});this.GetDragDropObject().OnDragEnter.RegisterMethod(function(){timedExpansion=setTimeout(function(){me.SetIsExpanded(true)},1E3)})}if((calculatedMode==D2L.DragDrop.Modes.Droppable||calculatedMode==D2L.DragDrop.Modes.DraggableDroppable)&&this.m_hasAutoExpandOnDragOver)this.GetDragDropObject().OnDragExit.RegisterMethod(function(){if(timedExpansion)clearTimeout(timedExpansion)});
if(ddObject){var me=this;ddObject.SetCustomGhostRenderer(function(){if(me.IsExpanded()){var ul=me.CreateElement("ul");ul.className="dt_mn";ul.style.width=me.GetTree().GetDomNode().offsetWidth+"px";var clone=me.GetDomNode().cloneNode(true);ul.appendChild(clone);return ul}else{var clone=handle.cloneNode(true);clone.style.width=handle.offsetWidth+"px";return handle.cloneNode(true)}})}}if(this.GetTree().GetHasSiblingDragDrop()){var siblingTopDDObject=new D2L.DragDrop.Droppable(this,this.m_siblingTopDragDropTarget);
var siblingBottomDDObject=new D2L.DragDrop.Droppable(this,this.m_siblingBottomDragDropTarget);siblingTopDDObject.SetData("DropLocation",D2L.Control.Tree.TreeNode.SiblingDropTargets.Top);siblingBottomDDObject.SetData("DropLocation",D2L.Control.Tree.TreeNode.SiblingDropTargets.Bottom);var me=this;siblingTopDDObject.OnDragEnter.RegisterMethod(function(){me.m_siblingTopDragDropTarget.firstChild.style.visibility="visible"});siblingTopDDObject.OnDragExit.RegisterMethod(function(){me.m_siblingTopDragDropTarget.firstChild.style.visibility=
"hidden"});siblingTopDDObject.OnDragDropped.RegisterMethod(function(){me.m_siblingTopDragDropTarget.firstChild.style.visibility="hidden"});siblingBottomDDObject.OnDragEnter.RegisterMethod(function(){me.m_siblingBottomDragDropTarget.firstChild.style.visibility="visible"});siblingBottomDDObject.OnDragExit.RegisterMethod(function(){me.m_siblingBottomDragDropTarget.firstChild.style.visibility="hidden"});siblingBottomDDObject.OnDragDropped.RegisterMethod(function(){me.m_siblingBottomDragDropTarget.firstChild.style.visibility=
"hidden"});D2L.DragDrop.SetDragDropInfo(siblingTopDDObject,this.GetTree().GetSiblingDragDropInfo());D2L.DragDrop.SetDragDropInfo(siblingBottomDDObject,this.GetTree().GetSiblingDragDropInfo())}},InstallEvents:function(){var me=this;this.OnBeforeActivate.RegisterMethod(function(){me.m_isActive=true;me.m_expandCollapseIcon.parentNode.insertBefore(me.m_selectedATHelp,me.m_expandCollapseIcon.nextSibling)});this.OnBeforeDeactivate.RegisterMethod(function(){me.m_isActive=false;if(me.m_selectedATHelp.parentNode)me.m_selectedATHelp.parentNode.removeChild(me.m_selectedATHelp)});
if(this.GetDragDropObject()==null)this.InstallDragDrop();this.OnSubjectChange.RegisterMethod(function(){if(me.m_checkboxControl)me.m_checkboxControl.SetText(new D2L.LP.Text.LangTerm("Framework.Tree.altSelect",me.m_subject));if(me.m_expandAltText&&me.m_collapseAltText){me.m_expandAltText.SetSubject(me.m_subject);me.m_collapseAltText.SetSubject(me.m_subject);if(me.m_expandCollapseIcon)me.m_collapseAltText.GetText().Register(function(t){me.m_expandCollapseIcon.title=t;me.m_expandCollapseIcon.firstChild.alt=
t;me.m_expandCollapseIcon.firstChild.title=t});if(me.m_expandCollapseIcon)me.m_expandAltText.GetText().Register(function(t){me.m_expandCollapseIcon.title=t;me.m_expandCollapseIcon.firstChild.alt=t;me.m_expandCollapseIcon.firstChild.title=t})}})},IsAncestor:function(node){var isAncestor=false;var nextNode=this.GetParentNode();while(nextNode){if(nextNode==node){isAncestor=true;break}nextNode=nextNode.GetParentNode()}return isAncestor},IsDraggabilityOverridden:function(){return this.m_overrideDraggability},
IsDroppabilityOverridden:function(){return this.m_overrideDroppability},IsExpanded:function(){return this.m_isExpanded},Reload:function(){var dl=new D2L.Util.DelayedReturn;if(!this.m_loadChildNodesOnDemand){var me=this;this.m_doNotAdjust=true;var allNodes=this.GetChildNodes();for(var i=allNodes.length-1;i>=0;i--)allNodes[i].Remove();this.m_doNotAdjust=false;this.FetchChildNodes(this).Register(function(childNodes){me.AddNodes(childNodes);dl.Trigger()})}else dl.Trigger();return dl},Remove:function(){arguments.callee.$.Remove.call(this);
var parentNode=this.GetParentNode();if(parentNode){for(var i=0;i<parentNode.GetChildNodes().length;i++)if(parentNode.GetChildNodes()[i]==this)break;parentNode.m_childNodes.splice(i,1);if(this.GetTree()&&!this.m_doNotAdjust)this.m_tree.GetRoot().Adjust()}},RenderSelection:function(){if(this.m_checkboxControl==null){this.m_checkboxControl=new D2L.Control.Checkbox;this.m_checkboxControl.SetShowText(false);var me=this;this.m_checkboxControl.SetOnClick(function(){me.SetIsSelected(me.m_checkboxControl.IsChecked())});
this.m_checkboxControl.SetText(new D2L.LP.Text.LangTerm("Framework.Tree.altSelect",this.GetSubject()))}this.m_checkboxControl.SetIsChecked(this.GetIsSelected());this.m_checkboxControl.SetIsEnabled(this.GetIsSelectionEnabled())},Render:function(){},SetCollapseIconImageTerm:function(imageTerm){this.m_collapseImgTerm=imageTerm},SetData:function(key,val){this.m_data.Add(key,val)},SetDragDropObject:function(ddObject){this.m_ddObject=ddObject},SetDragDropHandle:function(ddHandle){this.m_ddHandle=ddHandle},
SetExpandCollapseCustomPlaceholder:function(customPlaceholder){this.m_customExpandCollapseIconPlaceholder=customPlaceholder},SetSelectionCheckboxCustomPlaceholder:function(customPlaceholder){this.m_customSelectionCheckboxPlaceholder=customPlaceholder},SetExpandIconImageTerm:function(imageTerm){this.m_expandImgTerm=imageTerm},SetHasSelection:function(hasSelection){if(this.GetHasSelection()!=hasSelection){this.m_hasSelection=hasSelection;if(this.IsRendered())if(hasSelection){this.RenderSelection();
if(!this.m_checkboxControl.IsRendered())this.m_checkboxControl.BuildDom();if(this.m_customSelectionCheckboxPlaceholder==null)this.m_renderedNodeWrapper.insertBefore(this.m_checkboxControl.GetDomNode(),this.m_renderedNodeWrapper.firstChild);else this.m_checkboxControl.AppendTo(this.m_customSelectionCheckboxPlaceholder)}else this.m_checkboxControl.Remove()}},SetIsSelectionEnabled:function(isSelectionEnabled){this.m_isSelectionEnabled=isSelectionEnabled;if(this.IsRendered()){this.RenderSelection();this.OnSelectionEnableDisableChange.Trigger(isSelectionEnabled)}},
SetIsSelected:function(isSelected){this.m_isSelected=isSelected;if(this.IsRendered()&&this.m_checkboxControl){this.m_checkboxControl.SetIsChecked(this.GetIsSelected());this.OnSelectionChange.Trigger(isSelected)}},SetLevelSpacing:function(levelSpacing){this.m_levelSpacing=levelSpacing},Serialize:function(serializer){serializer.AddMember("IsExpanded",this.m_isExpanded);serializer.AddMember("IsActiveNode",this.m_isActive);serializer.AddMember("Key",this.m_key);serializer.AddMember("Data",this.m_data);
serializer.AddMember("ChildNodes",this.GetChildNodes());serializer.AddMember("OnDemand",this.m_loadChildNodesOnDemand);serializer.AddMember("Subject",this.m_subject);if(this.m_hasSelection&&this.m_isSelected)serializer.AddMember("IsSelected",this.m_isSelected)},SetIsExpanded:function(isExpanded,animate){if(animate===undefined)animate=true;var dl=new D2L.Util.DelayedReturn;var me=this;if(this.m_isExpanded!=isExpanded)if(this.m_loadChildNodesOnDemand&&!this.m_fetchInProgress){this.m_fetchInProgress=
true;this.FetchChildNodes(this).Register(function(childNodes){me.m_loadChildNodesOnDemand=false;me.m_fetchInProgress=false;me.AddNodes(childNodes);me.SetIsExpanded(true).Register(function(){dl.Trigger()});var href=me.GetWindow().document.createAttribute("href");href.value="javascript://";me.m_expandCollapseIcon.attributes.setNamedItem(href)});me.m_expandCollapseIcon.firstChild.src="/d2l/img/lp/loading.gif";if(me.m_expandCollapseIcon.attributes.getNamedItem("href"))me.m_expandCollapseIcon.attributes.removeNamedItem("href")}else{var DoExpandCollapse=
function(){if(isExpanded){me.m_collapseImgTerm.Assign(me.m_expandCollapseIcon.firstChild,false);me.m_collapseAltText.GetText().Register(function(t){me.m_expandCollapseIcon.title=t;me.m_expandCollapseIcon.firstChild.alt=t;me.m_expandCollapseIcon.firstChild.title=t});me.IChildrenDomNode.style.display="block"}else{me.m_expandImgTerm.Assign(me.m_expandCollapseIcon.firstChild,false);me.m_expandAltText.GetText().Register(function(t){me.m_expandCollapseIcon.title=t;me.m_expandCollapseIcon.firstChild.alt=
t;me.m_expandCollapseIcon.firstChild.title=t});me.IChildrenDomNode.style.display="none"}var nav=new D2L.NavInfo;me.AttachObject(me.m_expandCollapseIcon,"onclick",function(evt){D2L.Util.Dom.CancelBubble(evt);me.SetIsExpanded(!isExpanded);return false});me.m_isExpanded=isExpanded;if(isExpanded)me.OnExpand.Trigger();else me.OnCollapse.Trigger();dl.Trigger()};if(animate&&this.GetChildNodes().length<20){var DoAnimate=function(height){var toOpt=1;var fromOpt=0.2;if(!isExpanded){toOpt=0.2;fromOpt=1}me.IChildrenDomNode.style.position=
"relative";me.IChildrenDomNode.style.zoom="1";var sizeAnim=new YAHOO.util.Anim(me.IChildrenDomNode,{height:{to:height}},me.m_expandCollapseAnimationSpeed,YAHOO.util.Easing.easeNone);var fadeAnim=new YAHOO.util.ColorAnim(me.IChildrenDomNode,{opacity:{from:fromOpt,to:toOpt}},me.m_expandCollapseAnimationSpeed,YAHOO.util.Easing.easeNon);sizeAnim.onComplete.subscribe(function(){me.IChildrenDomNode.style.position="";me.IChildrenDomNode.style.zoom="";me.IChildrenDomNode.style.overflow="visible";me.IChildrenDomNode.style.height=
"";if(me.IChildrenDomNode.style.filter)me.IChildrenDomNode.style.filter="";else me.IChildrenDomNode.style.opacity="";var href=me.GetWindow().document.createAttribute("href");href.value="javascript://";me.m_expandCollapseIcon.attributes.setNamedItem(href);DoExpandCollapse()});if(isExpanded)me.IChildrenDomNode.style.height="0px";me.IChildrenDomNode.style.display="block";me.IChildrenDomNode.style.overflow="hidden";if(me.m_expandCollapseIcon.attributes.getNamedItem("href"))me.m_expandCollapseIcon.attributes.removeNamedItem("href");
sizeAnim.animate();fadeAnim.animate()};if(isExpanded){var h=0;if(this.IChildrenDomNode.childNodes.length>0)h=D2L.Util.Dom.GetHeightHelper(this.IChildrenDomNode);DoAnimate(h)}else DoAnimate(0)}else DoExpandCollapse()}else dl.Trigger();return dl},SetKey:function(key){this.m_key=key},SetLoadChildNodesOnDemand:function(isOnDemand){this.m_loadChildNodesOnDemand=isOnDemand;if(isOnDemand){this.m_isExpanded=false;this.m_childNodes=[]}},SetParentNode:function(parentNode){this.m_parentNode=parentNode},SetSubject:function(subject){this.m_subject=
subject;this.OnSubjectChange.Trigger()},SetTree:function(tree){this.m_tree=tree;for(var i=0;i<this.GetChildNodes().length;i++)this.GetChildNodes()[i].SetTree(tree)},SetWidth:function(width){this.m_wrapper2.style.width=width}});D2L.Control.Tree.TreeNode.SiblingDropTargets={Top:0,Bottom:1};
D2L.Control.Tree.TextTreeNode=D2L.Control.Tree.TreeNode.extend({Construct:function(){arguments.callee.$.Construct.call(this);this.m_allowWrap=true;this.m_alt=null;this.m_imageExpanded=null;this.m_hasActivation=true;this.m_hasHighlighting=true;this.m_image=null;this.m_imageControl=null;this.m_navInfo=null;this.m_text=null;this.m_textFormat=D2L.Control.TextFormat.Normal},Deserialize:function(deserializer){arguments.callee.$.Deserialize.call(this,deserializer);this.m_imageExpanded=deserializer.GetObject("ImageExpanded",
D2L.Images.Image);this.m_navInfo=deserializer.GetObject("NavInfo",D2L.NavInfo);this.m_image=deserializer.GetObject("Image",D2L.Images.Image);if(this.m_image===undefined)this.m_image=null;if(this.m_imageExpanded==null||this.m_imageExpanded===undefined)this.m_imageExpanded=this.m_image;this.m_text=deserializer.GetObject("Text",D2L.LP.Text.IText);this.m_textFormat=deserializer.GetMember("TextFormat");this.m_alt=deserializer.GetObject("Alt",D2L.LP.Text.IText);this.m_hasActivation=deserializer.GetMember("HasActivation");
this.m_hasHighlighting=deserializer.GetMember("HasHighlighting");this.m_allowWrap=deserializer.GetMember("AllowWrap")},Render:function(){this.m_wrapper=this.CreateElement("span");this.m_wrapper.style.padding="2px";if(!this.m_allowWrap)this.m_wrapper.style.whiteSpace="nowrap";if(this.m_hasActivation)this.RenderActive(this.GetIsActive());this.m_imageControl=new D2L.Control.Image;this.m_imageControl.SetText(this.m_text);this.m_imageControl.SetNav(this.m_navInfo);if(this.IsExpanded()){if(this.m_imageExpanded)this.m_imageControl.SetImage(this.m_imageExpanded)}else if(this.m_image)this.m_imageControl.SetImage(this.m_image);
this.SetTextFormat(this.m_textFormat);if(this.m_alt)this.SetAlt(this.m_alt);this.m_imageControl.AppendTo(this.m_wrapper);this.InstallEvents();return this.m_wrapper},GetNav:function(){return this.m_navInfo},GetText:function(){return this.m_text},InstallEvents:function(){this.SetDragDropHandle(this.m_wrapper);arguments.callee.$.InstallEvents.call(this);var me=this;if(this.m_hasActivation)this.AttachObject(this.m_imageControl.GetDomNode(),"onclick",function(){me.m_imageControl.Focus();me.GetTree().SetActiveNode(me)});
this.SetHasActivation(this.m_hasActivation);this.SetHasHighlighting(this.m_hasHighlighting);this.OnExpand.RegisterMethod(function(){if(me.m_imageExpanded)me.m_imageControl.SetImage(me.m_imageExpanded)});this.OnCollapse.RegisterMethod(function(){if(me.m_image)me.m_imageControl.SetImage(me.m_image)});this.OnSubjectChange.RegisterMethod(function(){me.SetAlt(me.m_alt)})},HandleOnMouseOver:function(){if(this.m_hasHighlighting&&!this.GetIsActive())this.m_wrapper.style.backgroundColor="#E2EEFF"},HandleOnMouseOut:function(){if(this.m_hasHighlighting){this.m_wrapper.style.backgroundColor=
"";this.RenderActive(this.GetIsActive())}},RenderActive:function(isActive){if(this.m_hasActivation)if(isActive)this.m_wrapper.style.backgroundColor="#B3C8E8";else this.m_wrapper.style.backgroundColor=""},SetAllowWrap:function(allowWrap){this.m_allowWrap=allowWrap;if(this.m_wrapper)if(allowWrap)this.m_wrapper.style.whiteSpace="normal";else this.m_wrapper.style.whiteSpace="nowrap"},SetAlt:function(alt){this.m_alt=alt;if(this.GetSubject())this.m_alt.SetSubject(this.GetSubject());if(this.m_imageControl)this.m_imageControl.SetAlt(this.m_alt)},
SetHasActivation:function(hasActivation){this.m_hasActivation=hasActivation;var me=this;if(this.m_hasActivation){this.OnBeforeActivate.RegisterMethod(function(){me.RenderActive(true)});this.OnBeforeDeactivate.RegisterMethod(function(){me.RenderActive(false)})}},SetHasHighlighting:function(hasHighlighting){this.m_hasHighlighting=hasHighlighting;if(this.m_wrapper){var me=this;if(this.m_hasHighlighting){this.AttachObject(this.m_wrapper,"onmouseover",function(){me.HandleOnMouseOver()});this.AttachObject(this.m_wrapper,
"onmouseout",function(){me.HandleOnMouseOut()});if(!this.IsDroppabilityOverridden()&&(this.GetTree().GetDragDropMode()==D2L.DragDrop.Modes.DraggableDroppable||this.GetTree().GetDragDropMode()==D2L.DragDrop.Modes.Droppable)){this.GetDragDropObject().OnDragEnter.Register(this,"HandleOnMouseOver");this.GetDragDropObject().OnDragExit.Register(this,"HandleOnMouseOut")}}}},SetImage:function(img){this.m_image=img;if(this.m_imageExpanded==null)this.m_imageExpanded=this.m_image;if(this.m_imageControl)if(this.m_imageExpanded==
null||!this.IsExpanded())this.m_imageControl.SetImage(this.m_image)},SetImageExpanded:function(img){this.m_imageExpanded=img;if(this.m_imageControl)if(this.IsExpanded())this.m_imageControl.SetImage(this.m_imageExpanded)},SetNav:function(navInfo){this.m_navInfo=navInfo;if(this.m_imageControl)this.m_imageControl.SetNav(navInfo)},SetText:function(text){this.m_text=text;if(this.m_imageControl)this.m_imageControl.SetText(text)},SetTextFormat:function(textFormat){this.m_textFormat=textFormat;if(this.m_wrapper)if(this.m_textFormat==
D2L.Control.TextFormat.Bold)this.m_wrapper.className="dt_tn_wb";else this.m_wrapper.className="dt_tn_wn"}});if(window["D2L"]!==undefined&&D2L.LP.Web.Packaging!==undefined)D2L.LP.Web.Packaging.Register("D2L.LP.Web.Controls.Tree.default");